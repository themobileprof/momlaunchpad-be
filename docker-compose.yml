# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-spec/master/schema/compose-spec.json

services:
  # Backend API (connects to host PostgreSQL)
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: momlaunchpad-api
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - DATABASE_URL=postgresql://samuel:tummy@host.docker.internal:5432/momlaunchpad?sslmode=disable
    volumes:
      - ./.env:/app/.env
    ports:
      - "${PORT:-8080}:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    # DNS configuration for external API access
    dns:
      - 8.8.8.8
      - 1.1.1.1
    # Security hardening
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
